<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Sci-Fi Ops Console – Radar | Sonar | Spectrum</title>

<!-- Font -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<style>
  :root{
    /* Bluish sci-fi palette */
    --bg:#07141a;
    --bg-2:#051015;
    --panel:#0a1e26;
    --panel-border:#113645;
    --glow:#00e0ff;
    --glow-soft:#00e0ff55;
    --text:#c7f6ff;
    --muted:#7fb7c4;

    --ring:#0b4a62;
    --grid:#0e2f3b;

    --ship:#39e6ff;
    --air:#00b7ff;
    --human:#9be67a;

    --danger:#ff4d6d;
    --ok:#12d6a0;
  }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:
    radial-gradient(1200px 900px at 20% -10%, #0a1f27 0%, transparent 60%),
    radial-gradient(1000px 800px at 120% 120%, #09212a 0%, transparent 60%),
    linear-gradient(#041017, #07141a);
    color:var(--text); font-family:'Orbitron',system-ui,Segoe UI,Roboto,Arial;
    letter-spacing:.04em;
  }

  .wrap{
    max-width:1400px; margin:24px auto; padding:16px;
    display:grid; gap:16px;
    grid-template-columns: 1.1fr 0.9fr;
    grid-template-rows:auto auto;
  }

  .tool{
    background:linear-gradient(180deg,var(--panel),var(--bg-2));
    border:1px solid var(--panel-border);
    border-radius:16px; padding:14px 14px 10px;
    box-shadow:
      0 10px 35px #0009,
      inset 0 0 0 1px #ffffff06,
      inset 0 0 40px #000a;
    position:relative; overflow:hidden;
  }
  .tool:before{
    content:""; position:absolute; inset:-1px;
    border-radius:16px;
    box-shadow:0 0 60px 10px var(--glow-soft) inset;
    pointer-events:none; opacity:.25;
  }
  .title{
    display:flex; align-items:center; gap:10px; margin:0 0 10px;
    font-size:14px; color:var(--text);
  }
  .title .dot{
    width:10px;height:10px;border-radius:50%;
    background:radial-gradient(circle at 30% 30%, #aff, var(--glow));
    box-shadow:0 0 10px 2px var(--glow-soft);
  }
  .hud{
    position:absolute; inset:auto 10px 8px 10px;
    display:flex; justify-content:space-between; font-size:12px; color:var(--muted);
    text-shadow:0 0 8px #0006;
    pointer-events:none;
  }
  .legend{
    position:absolute; top:8px; right:10px; display:flex; gap:8px; align-items:center; font-size:11px; color:var(--muted);
    background:#0005; padding:4px 8px; border:1px solid #0a2a34; border-radius:10px; backdrop-filter: blur(4px);
  }
  .lg{display:flex; align-items:center; gap:6px}
  .lg .k{width:9px;height:9px;border-radius:50%}
  .k.ship{background:var(--ship); box-shadow:0 0 8px 2px #39e6ff55}
  .k.air{background:var(--air); box-shadow:0 0 8px 2px #00b7ff55}
  .k.human{background:var(--human); box-shadow:0 0 8px 2px #9be67a55}

  canvas{display:block;width:100%;height:auto;border-radius:12px;}

  /* Layout positions */
  #radarTool{grid-column:1 / span 1; grid-row:1}
  #sonarTool{grid-column:2 / span 1; grid-row:1}
  #spectrumTool{grid-column:1 / span 2; grid-row:2}

  /* Subtle scanlines */
  .tool>canvas.overlay{
    pointer-events:none;
    position:absolute; inset:36px 10px 30px 10px; border-radius:10px;
    background:
      repeating-linear-gradient(transparent,transparent 2px, rgba(255,255,255,0.015) 2px, rgba(255,255,255,0.015) 3px);
    mix-blend-mode:overlay; opacity:.4;
  }

  .tips{
    max-width:1400px;margin:6px auto 20px;padding:0 18px; color:var(--muted); font-size:12px;
  }
  .pill{
    display:inline-block; padding:2px 8px; border:1px solid #0a2a34; border-radius:999px; background:#0a1820; color:#aee; margin-right:6px;
  }

  @media (max-width:1000px){
    .wrap{grid-template-columns:1fr; grid-template-rows:auto auto auto}
    #radarTool{grid-column:1}
    #sonarTool{grid-column:1}
    #spectrumTool{grid-column:1}
  }
</style>
</head>
<body>

<div class="wrap">

  <!-- ======================= RADAR (PPI) ======================= -->
  <section id="radarTool" class="tool">
    <h3 class="title"><span class="dot"></span> PPI RADAR — Surface & Air</h3>
    <div class="legend">
      <span class="lg"><span class="k ship"></span>Ship</span>
      <span class="lg"><span class="k air"></span>Air</span>
      <span class="lg"><span class="k human"></span>Human</span>
    </div>
    <canvas id="radar" width="900" height="900" aria-label="radar display"></canvas>
    <canvas class="overlay" aria-hidden="true"></canvas>
    <div class="hud">
      <div>BRG: <span id="bearing">000°</span> | RNG: <span id="rangeKm">50</span> km</div>
      <div>BLIPS: <span id="blipCount">0</span> | SCALE: <span id="scaleText">1px=?m</span></div>
    </div>
  </section>

  <!-- ======================= SONAR WATERFALL ======================= -->
  <section id="sonarTool" class="tool">
    <h3 class="title"><span class="dot"></span> ACTIVE SONAR — Waterfall</h3>
    <canvas id="sonar" width="600" height="420" aria-label="sonar waterfall"></canvas>
    <canvas class="overlay" aria-hidden="true"></canvas>
    <div class="hud">
      <div>DEPTH WINDOW: 0–800 m</div>
      <div>ECHO INTENSITY</div>
    </div>
  </section>

  <!-- ======================= SIGNAL SPECTRUM ======================= -->
  <section id="spectrumTool" class="tool">
    <h3 class="title"><span class="dot"></span> SIGNAL SPECTRUM — RF Sweep</h3>
    <canvas id="spectrum" width="1280" height="320" aria-label="spectrum analyzer"></canvas>
    <canvas class="overlay" aria-hidden="true"></canvas>
    <div class="hud">
      <div>SWEEP: 2.1–2.5 GHz</div>
      <div>THREATS: auto-flagged peaks</div>
    </div>
  </section>

</div>

<!-- Icons (Lucide, via CDN) -->
<img id="ic-plane"  src="https://unpkg.com/lucide-static@0.344.0/icons/plane.svg"  hidden crossorigin="anonymous">
<img id="ic-ship"   src="https://unpkg.com/lucide-static@0.344.0/icons/ship.svg"   hidden crossorigin="anonymous">
<img id="ic-human"  src="https://unpkg.com/lucide-static@0.344.0/icons/person-standing.svg" hidden crossorigin="anonymous">

<script>
(()=>{

/* ========= Helpers ========= */
const clamp=(x,a,b)=>Math.max(a,Math.min(b,x));
const degToRad = d => d*Math.PI/180;
const radToDeg = r => r*180/Math.PI;
const rnd=(a=0,b=1)=>a+Math.random()*(b-a);

/* ========= PPI RADAR ========= */
const radarCanvas=document.getElementById('radar');
const rctx=radarCanvas.getContext('2d');
const R=radarCanvas.width/2;
const center={x:R,y:R};

const icPlane=document.getElementById('ic-plane');
const icShip=document.getElementById('ic-ship');
const icHuman=document.getElementById('ic-human');

const bearingEl=document.getElementById('bearing');
const blipCountEl=document.getElementById('blipCount');
const scaleTextEl=document.getElementById('scaleText');
const rangeKmEl=document.getElementById('rangeKm');

const state={
  rangeKm:50,
  angle:0,
  sweepDps:120,
  fadeSec:1.6,
  noise:0.16,
  targets:[],
  last:performance.now()
};

rangeKmEl.textContent=state.rangeKm.toFixed(0);

const metersPerPixel=()=> (state.rangeKm*1000)/(R*0.92);
const polarToXY=(rPx,ang)=>{const t=degToRad(ang-90);return {x:center.x+rPx*Math.cos(t), y:center.y+rPx*Math.sin(t)}};

/* --- static grid pre-render --- */
const grid=document.createElement('canvas');
grid.width=radarCanvas.width; grid.height=radarCanvas.height;
const g=grid.getContext('2d');

function drawGrid(){
  g.clearRect(0,0,grid.width,grid.height);

  // soft background glow
  const glow=g.createRadialGradient(center.x,center.y,0, center.x,center.y,R);
  glow.addColorStop(0,'rgba(0,224,255,0.10)');
  glow.addColorStop(1,'rgba(0,0,0,0)');
  g.fillStyle=glow; g.beginPath(); g.arc(center.x,center.y,R,0,Math.PI*2); g.fill();

  // rings
  g.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--ring');
  g.setLineDash([2,6]); g.lineWidth=1;
  for(let i=1;i<=5;i++){
    const r=(R*0.92)*(i/5);
    g.beginPath(); g.arc(center.x,center.y,r,0,Math.PI*2); g.stroke();
    // label
    g.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--muted');
    g.font='12px Orbitron';
    g.textAlign='center';
    g.fillText(`${Math.round(state.rangeKm*i/5)} km`, center.x, center.y-r-6);
  }
  g.setLineDash([]);

  // crosshairs
  g.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--grid');
  for(let i=0;i<4;i++){
    const a=i*90, p1=polarToXY(R*0.92,a), p2=polarToXY(R*0.92,a+180);
    g.beginPath(); g.moveTo(p1.x,p1.y); g.lineTo(p2.x,p2.y); g.stroke();
  }

  // bearings
  const txt=getComputedStyle(document.documentElement).getPropertyValue('--text');
  g.fillStyle=txt; g.font='12px Orbitron';
  for(let a=0;a<360;a+=30){
    const pOuter=polarToXY(R*0.92,a), pInner=polarToXY(R*0.88,a);
    g.strokeStyle='#113d4b';
    g.beginPath(); g.moveTo(pInner.x,pInner.y); g.lineTo(pOuter.x,pOuter.y); g.stroke();
    const label=(a===0?'000':String(a).padStart(3,'0'))+'°';
    const pLbl=polarToXY(R*0.78,a);
    g.save(); g.translate(pLbl.x,pLbl.y); g.rotate(degToRad(a)); g.textAlign='center'; g.fillText(label,0,0); g.restore();
  }
}
drawGrid();

/* --- targets --- */
function addTarget(kind, rKm, bearing){
  const dir=(Math.random()<.5?-1:1)*rnd(0,60);
  const drift=rnd(-0.02,0.02);
  state.targets.push({id:cryptoRandomId(), kind, rKm, bearing, velDps:dir/3.6, vrKps:drift, lastPing:-999});
}
function cryptoRandomId(){
  return Math.random().toString(36).slice(2) + Math.random().toString(36).slice(2);
}
function seed(){
  state.targets.length=0;
  for(let i=0;i<5;i++) addTarget('ship', rnd(0.8, state.rangeKm*0.85), rnd(0,360));
  for(let i=0;i<4;i++) addTarget('air' , rnd(3,   state.rangeKm*0.95), rnd(0,360));
  for(let i=0;i<3;i++) addTarget('human', rnd(0.2, 3.5), rnd(0,360));
}
seed();

/* --- drawing --- */
function update(dt){
  // sweep
  state.angle=(state.angle+state.sweepDps*dt)%360;

  // move targets
  for(const t of state.targets){
    t.bearing=(t.bearing + t.velDps*dt + 360)%360;
    t.rKm = clamp(t.rKm + t.vrKps*dt, 0.08, state.rangeKm*0.98);
  }
}

function drawSweep(){
  const col=getComputedStyle(document.documentElement).getPropertyValue('--glow');
  rctx.save();
  rctx.globalCompositeOperation='lighter';
  rctx.shadowColor=col; rctx.shadowBlur=25; rctx.globalAlpha=0.8;

  const grad=rctx.createRadialGradient(center.x,center.y,0, center.x,center.y,R*0.92);
  grad.addColorStop(0,col); grad.addColorStop(1,'rgba(0,255,255,0)');
  rctx.fillStyle=grad;
  rctx.beginPath();
  rctx.moveTo(center.x,center.y);
  rctx.arc(center.x,center.y,R*0.92, degToRad(state.angle-1.4), degToRad(state.angle+1.4));
  rctx.closePath(); rctx.fill();

  // beam line
  rctx.lineWidth=2; rctx.strokeStyle=col;
  const tip=polarToXY(R*0.92, state.angle);
  rctx.beginPath(); rctx.moveTo(center.x,center.y); rctx.lineTo(tip.x,tip.y); rctx.stroke();
  rctx.restore();

  // HUD
  bearingEl.textContent=String(Math.round((state.angle+360)%360)).padStart(3,'0')+'°';
}

function drawTargets(dt){
  const scale=1/metersPerPixel();
  blipCountEl.textContent = state.targets.length;
  scaleTextEl.textContent = `1px≈${metersPerPixel().toFixed(1)}m`;

  for(const t of state.targets){
    const rPx=(t.rKm*1000)*scale, ang=t.bearing;

    // ping “when sweep hits”
    const dAng=Math.abs(((ang-state.angle+540)%360)-180);
    if(dAng<1.1 && (performance.now()-t.lastPing)>600) t.lastPing=performance.now();
    const age=(performance.now()-t.lastPing)/1000;
    const alpha=Math.max(0,1 - age/state.fadeSec);

    // false noise blips
    if(Math.random()<state.noise*dt){
      const np=polarToXY(rnd(6,R*0.9), rnd(0,360));
      rctx.save(); rctx.globalAlpha=rnd(0.25,0.55); rctx.fillStyle='#86f6ff';
      rctx.beginPath(); rctx.arc(np.x,np.y, rnd(1.5,3.2), 0, Math.PI*2); rctx.fill(); rctx.restore();
    }

    if(alpha<=0) continue;

    const p=polarToXY(rPx, ang);
    const img = t.kind==='ship' ? icShip : t.kind==='air' ? icPlane : icHuman;
    const col = t.kind==='ship' ? getVar('--ship') : t.kind==='air' ? getVar('--air') : getVar('--human');

    // glow dot under icon
    rctx.save();
    rctx.globalAlpha=alpha*0.9;
    rctx.fillStyle=col; rctx.shadowColor=col; rctx.shadowBlur=12;
    rctx.beginPath(); rctx.arc(p.x,p.y,3.2,0,Math.PI*2); rctx.fill();
    rctx.restore();

    // icon
    const size = (t.kind==='human'?14:16)+ 6*(1 - t.rKm/state.rangeKm);
    rctx.save();
    rctx.globalAlpha=alpha;
    rctx.translate(p.x,p.y);
    rctx.rotate(degToRad(ang));
    rctx.drawImage(img, -size/2, -size/2, size, size);
    rctx.restore();
  }
}

function getVar(name){ return getComputedStyle(document.documentElement).getPropertyValue(name).trim() }

/* --- main radar loop with persistence --- */
function radarFrame(now){
  const dt = Math.min(0.05, (now - state.last)/1000); state.last = now;

  // fade previous frame = CRT persistence
  rctx.save();
  rctx.globalCompositeOperation='source-over';
  rctx.fillStyle=`rgba(0,0,0,${clamp(1/(state.fadeSec*60),0.02,0.14)})`;
  rctx.fillRect(0,0,radarCanvas.width,radarCanvas.height);
  rctx.restore();

  // static grid
  rctx.drawImage(grid,0,0);

  update(dt);
  drawSweep();
  drawTargets(dt);

  requestAnimationFrame(radarFrame);
}

/* --- interactions: click to drop targets ---
   click = human, Shift+click = ship, Alt/Option+click = airplane */
radarCanvas.addEventListener('click', (e)=>{
  const rect=radarCanvas.getBoundingClientRect();
  const x=(e.clientX-rect.left)*(radarCanvas.width/rect.width);
  const y=(e.clientY-rect.top)*(radarCanvas.height/rect.height);
  const dx=x-center.x, dy=y-center.y;
  const rPx=Math.hypot(dx,dy);
  const ang=(radToDeg(Math.atan2(dy,dx))+90+360)%360;
  const rKm=(rPx*metersPerPixel())/1000;
  const kind = e.altKey ? 'air' : (e.shiftKey ? 'ship' : 'human');
  if(rKm <= state.rangeKm*0.98 && rKm>0.08) addTarget(kind, rKm, ang);
});

/* ========= SONAR WATERFALL ========= */
const sonar=document.getElementById('sonar');
const sctx=sonar.getContext('2d');
const SON_W=sonar.width, SON_H=sonar.height;

let sonarLast=performance.now();
function sonarFrame(now){
  const dt = (now - sonarLast)/1000; sonarLast=now;
  // scroll down
  const row=4; // pixels added per tick
  const img=sctx.getImageData(0,0,SON_W,SON_H-row);
  sctx.putImageData(img,0,row);
  // draw new top line
  const grd=sctx.createLinearGradient(0,0,SON_W,0);
  for(let i=0;i<=10;i++){
    const n= i/10;
    const noise = Math.pow(Math.random(),2.0);
    grd.addColorStop(n, `rgba(${20+noise*60},${80+noise*100},${120+noise*100},${0.20+noise*0.12})`);
  }
  sctx.fillStyle=grd; sctx.fillRect(0,0,SON_W,row);

  // pings (simulate echoes)
  for(let i=0;i<rnd(1,3)|0;i++){
    const x=rnd(40, SON_W-40);
    const strength=rnd(0.5,1.0);
    const w=rnd(20,110);
    const g=sctx.createRadialGradient(x, row/2, 2, x, row/2, w);
    g.addColorStop(0, `rgba(0,255,255,${0.45*strength})`);
    g.addColorStop(1, `rgba(0,255,255,0)`);
    sctx.fillStyle=g; sctx.beginPath(); sctx.arc(x, row/2, w, 0, Math.PI*2); sctx.fill();
  }

  requestAnimationFrame(sonarFrame);
}

/* ========= SPECTRUM ========= */
const spectrum=document.getElementById('spectrum');
const pctx=spectrum.getContext('2d');
const SP_W=spectrum.width, SP_H=spectrum.height;
let specLast=performance.now();

function spectrumFrame(now){
  const dt=(now-specLast)/1000; specLast=now;

  // background
  pctx.fillStyle='#05131a'; pctx.fillRect(0,0,SP_W,SP_H);

  // grid
  pctx.strokeStyle='#0d2a35'; pctx.lineWidth=1;
  pctx.beginPath();
  for(let x=0;x<=SP_W;x+=64){ pctx.moveTo(x,0); pctx.lineTo(x,SP_H); }
  for(let y=0;y<=SP_H;y+=40){ pctx.moveTo(0,y); pctx.lineTo(SP_W,y); }
  pctx.stroke();

  // sweep curve (several signals)
  const baseY = y=> SP_H - y;
  const t=performance.now()*0.001;

  for(let band=0; band<3; band++){
    const hue = band===0 ? 'rgba(0,220,255,0.9)' : band===1 ? 'rgba(0,255,180,0.85)' : 'rgba(80,240,255,0.8)';
    pctx.strokeStyle=hue; pctx.lineWidth=2;
    pctx.beginPath();
    for(let x=0; x<SP_W; x++){
      const nx=x/SP_W;
      let y =
        28*Math.sin(12*nx + t*1.8 + band) +
        16*Math.cos(30*nx - t*1.3 + band*0.6) +
        8*Math.sin(220*nx + t*2.6);
      // peaks (threats)
      const peaks=[0.18,0.42,0.77];
      for(const p of peaks){
        const d = Math.exp(-120*(nx-p)*(nx-p));
        y += d * 110*(0.7+0.3*Math.sin(t*5+band));
      }
      const yy = baseY(110 + y + band*6);
      if(x===0) pctx.moveTo(x,yy); else pctx.lineTo(x,yy);
    }
    pctx.stroke();
  }

  // threat markers
  drawPeakMarker(0.18, 'DRONE LINK');
  drawPeakMarker(0.42, 'RADAR ALT');
  drawPeakMarker(0.77, 'DATA BURST');

  requestAnimationFrame(spectrumFrame);

  function drawPeakMarker(nx, label){
    const x = Math.floor(nx*SP_W);
    pctx.strokeStyle='rgba(255,80,120,0.85)';
    pctx.fillStyle='rgba(255,80,120,0.18)';
    pctx.beginPath(); pctx.moveTo(x,0); pctx.lineTo(x,SP_H); pctx.stroke();
    pctx.fillRect(x-22,8,44,18);
    pctx.fillStyle='#ffdce6';
    pctx.font='12px Orbitron'; pctx.textAlign='center';
    pctx.fillText(label, x, 20);
  }
}

/* ========= start after icons decode ========= */
Promise.allSettled([decode(icPlane), decode(icShip), decode(icHuman)]).then(()=>{
  state.last=performance.now();
  requestAnimationFrame(radarFrame);
  requestAnimationFrame(sonarFrame);
  requestAnimationFrame(spectrumFrame);
});

function decode(img){
  if(img.decode) return img.decode().catch(()=>{});
  return new Promise(res=> img.complete ? res() : (img.onload=res, img.onerror=res));
}

/* ========= resize (HiDPI crispness) ========= */
function fitCanvasToCssPixels(canvas){
  const dpr = window.devicePixelRatio||1;
  const rect = canvas.getBoundingClientRect();
  if(canvas.width !== Math.round(rect.width*dpr) || canvas.height !== Math.round(rect.height*dpr)){
    canvas.width = Math.round(rect.width*dpr);
    canvas.height= Math.round(rect.height*dpr);
    return true;
  }
  return false;
}
function onResize(){
  [radarCanvas, document.querySelector('#sonar'), document.querySelector('#spectrum')].forEach(c=>{
    if(fitCanvasToCssPixels(c)){
      // re-draw grid when radar size changes
      if(c===radarCanvas){ grid.width=c.width; grid.height=c.height;
        // recompute R/center for radar
        const newR = radarCanvas.width/2;
        center.x=center.y=newR; // update
      }
    }
  });
  drawGrid();
}
window.addEventListener('resize', onResize, {passive:true});
setTimeout(onResize, 0);

})();
</script>

<div class="tips">
  <span class="pill">PPI Radar</span> Click to add <b>Human</b> • <b>Shift+Click</b> = Ship • <b>Alt/Option+Click</b> = Air.
  The sweep auto-pings objects; trails fade with CRT-style persistence.  
  <span class="pill">Sonar</span> Waterfall shows simulated echoes & noise.  
  <span class="pill">Spectrum</span> Live RF sweep with auto-flagged peaks.
</div>

</body>
</html>
